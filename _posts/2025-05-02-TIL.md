---
layout: post
title:  "LOCK에 대한 생각 정리"
author: "dongurijun"
tags: ["TIL"]
---



``` java

낙관적 락으로 시작
    낙관적 락은 데이터베이스 수준에서 락을 걸지 않기 때문에 데드락은 발생하지 않는다.
    데드락 대신, 낙관적 락은 충돌 감지(conflict detection) 방식으로 작동
    커밋 시점에 버전 충돌이 발생하면 예외가 발생하고 트랜잭션이 롤백
     -> 이는 데이터 일관성을 유지하면서도 동시 접근을 허용하여 성능을 향상


성능 문제나 높은 충돌률이 발생하면 비관적 락 고려 (하지만 신중하게)
    비관적 락은 데이터베이스 수준에서 행(row)을 잠그는 방식으로 작동하며, 
    이로 인해 애플리케이션 성능이 저하될 수 있다. 
    특히 트래픽이 많은 환경에서는 데드락(deadlock)이 발생할 가능성도 있어서 주의해서 사용

분산 환경에서는 Redis/Redisson과 같은 분산 락 메커니즘 도입

Spring에서 분산락을 구현하는 몇 가지 일반적인 방법

    커스텀 어노테이션 + AOP: @DistributedLock과 같은 커스텀 어노테이션을 만들고 
    AOP를 사용하여 해당 어노테이션이 적용된 메소드가 실행될 때 분산락을 획득하고 해제
    
    또는, redisson을 직접 사용
    RLock lock = redisson.getLock("myLock");
    lock.lock();
    try {
        // 임계 영역 코드 실행
    } finally {
        lock.unlock();
    }
    
```




